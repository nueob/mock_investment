<!DOCTYPE html>
<html lang="en">
 <style>.card-footer{background-color:#fff}</style>
 <style>.btn.btn-info{background-color:#f2f7ff; border-color: #f2f7ff; color:#002152;}</style>
<body>
    <div id="app">
        
        <div id="main">
            <style>
                body {
                 background-color:#f2f7ff;
                }
            </style>
             <!-- <header class="mb-3">
                <a href="#" class="burger-btn d-block ">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header> -->
            <div class="page-heading">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3>My page</h3>
                            
                        </div>
                        
                    </div>
                </div>
                <section class="section">
                    <div class="row">                
                        <div class="col-md-4 col-sm-12">
                            <div class="card">
                                <div class="avatar avatar-xl">
                                    <img src="/images/faces/1.jpg" class="mx-auto d-block" alt="Face 1">
                                </div>
                                <div class="ms-3 name ">
                                    <h5 class="font-bold text-center"><%= name %>님</h5>
                                    <h6 class="text-muted mb-0 text-center">@<%= nickname %></h6>
                                </div>                    
                                <div class="card-footer d-flex justify-content-center">
                                        <button id="password"
                                            class="btn btn-info btn-md font-bold mt-3" data-bs-toggle="modal"
                                            data-bs-target="#passwordChange"  >비밀번호 변경</button>
                                </div>
                                <div class="card-footer d-flex justify-content-center">
                                    <button id="password"
                                        class="btn btn-info btn-md font-bold mt-3" data-bs-toggle="modal"
                                        data-bs-target="#inlineForm"  >닉네임 변경</button>
                                </div>
                                <div class="modal fade text-left" id="passwordChange" tabindex="-1" role="dialog" aria-labelledby="myModalLabel33" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
                                        role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="myModalLabel33">변경할 비밀번호를 입력해주세요 </h4>
                                                <button type="button" class="close" data-bs-dismiss="modal"
                                                    aria-label="Close">
                                                    <i data-feather="x"></i>
                                                </button>
                                            </div>
                                            <div class="modal-body">

                                                <div class="form-group">
                                                    <input type="text" placeholder="현재 비밀번호를 입력하세요"
                                                        class="form-control" name="current_password">
                                                </div>
                                                
                                            </div>
                                            <div class="modal-body">

                                                <div class="form-group">
                                                    <input type="text" placeholder="변경 할 비밀번호를 입력하세요"
                                                        class="form-control" name="change_password">
                                                </div>
                                                
                                            </div>
                                            <div class="modal-body">

                                                <div class="form-group">
                                                    <input type="text" placeholder="변경 할 비밀번호를 한번 더 입력하세요"
                                                        class="form-control" name="change_repassword">
                                                </div>
                                                
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-light-secondary"
                                                    data-bs-dismiss="modal">
                                                    <i class="bx bx-x d-block d-sm-none"></i>
                                                    <span class="d-none d-sm-block">취소</span>
                                                </button>
                                                <button type="button" class="btn btn-primary ml-1"
                                                    id="password_change_btn" data-bs-dismiss="modal">
                                                    <i class="bx bx-check d-block d-sm-none"></i>
                                                    <span class="d-none d-sm-block">확인</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="modal fade text-left" id="inlineForm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel33" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
                                        role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h4 class="modal-title" id="myModalLabel33">변경할 닉네임을 입력해주세요 </h4>
                                                <button type="button" class="close" data-bs-dismiss="modal"
                                                    aria-label="Close">
                                                    <i data-feather="x"></i>
                                                </button>
                                            </div>
                                            <div class="modal-body">

                                                <div class="form-group">
                                                    <input type="text" placeholder="닉네임"
                                                        class="form-control" name="nickname_change">
                                                </div>
                                                
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-light-secondary"
                                                    data-bs-dismiss="modal">
                                                    <i class="bx bx-x d-block d-sm-none"></i>
                                                    <span class="d-none d-sm-block">취소</span>
                                                </button>
                                                <button type="button" class="btn btn-primary ml-1"
                                                    id="nickname_change_btn" data-bs-dismiss="modal">
                                                    <i class="bx bx-check d-block d-sm-none"></i>
                                                    <span class="d-none d-sm-block">확인</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist"
                                                aria-orientation="vertical">
                                                <a class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill"
                                                    href="#v-pills-home" role="tab" aria-controls="v-pills-home"
                                                    aria-selected="true">자산정보</a>
                                                <!-- <a class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill"
                                                    href="#v-pills-profile" role="tab" aria-controls="v-pills-profile"
                                                    aria-selected="false">진행중인 거래</a> -->
                                                <a class="nav-link" id="v-pills-messages-tab" data-bs-toggle="pill"
                                                    href="#v-pills-messages" role="tab" aria-controls="v-pills-messages"
                                                    aria-selected="false">거래내역</a>
                                                <!-- <a class="nav-link" id="v-pills-settings-tab" data-bs-toggle="pill"
                                                    href="#v-pills-settings" role="tab" aria-controls="v-pills-settings"
                                                    aria-selected="false">관심 종목</a>  -->
                                            </div> 
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-8 col-sm-12">
                            <div class="card border-0">
                                <div class="card-content">
                                    <div class="card-body">
                                     
                                        <div class="tab-content" id="v-pills-tabContent">
                                            <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel"
                                                aria-labelledby="v-pills-home-tab">
                                                <h1>자산정보</h1>
                                                <div class="table-responsive">
                                                    <table class="table ">
                                                        <tbody>
                                                            <tr>
                                                                <th class="text-bold-500" >총 자산</th>
                                                                <td><%= result[0][0].assets %></td>
                                                            </tr>
                                                            <tr>
                                                                <th class="text-bold-500">가용 자산</th>
                                                                <td><%= result[1][0].realAssets %></td>
                                                            </tr>
                                                            <tr>
                                                                <th class="text-bold-500">보유 주식 총액</th>
                                                                <td><%= result[1][0].share %></td>
                                                            </tr>
                                                            <tr>
                                                                <th class="text-bold-500">보유 주식 수</th>
                                                                <td><%= result[1][0].allAssets %> 종목</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div> 
                                            </div>
                                            <!-- <div class="tab-pane fade" id="v-pills-profile" role="tabpanel"
                                                aria-labelledby="v-pills-profile-tab">
                                                <h1>진행중인 거래</h1>
                                                <table class="table" cellspacing="0">
                                                    <thead>
                                                        <tr>
                                                            <th>Project Name</th>
                                                            <th>Employer</th>
                                                            <th>Awards</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <% for(info of result[2]) { %>
                                                        <tr>
                                                            <td><a href="#"><%= info.company_name %></a></td>
                                                            <td><%= info.stock %></td>
                                                            <td><%= info.memo %></td>
                                                        </tr>
                                                        <% } %>
                                                    </tbody>
                                                </table>
                                          
                                            </div> -->
                                            <div class="tab-pane fade" id="v-pills-messages" role="tabpanel"
                                                aria-labelledby="v-pills-messages-tab">
                                                <h1>거래내역</h1>
                                                <div class="table-responsive">
                                                    <table class="table table-bordered mb-0">
                                                        <tbody>
                                                            <% for(info of result[2]) { %>
                                                            <tr>
                                                                <th class="text-bold-500" ><%= info.company_name %></th>
                                                                <td><%= info.memo %><%= info.stock %>주</td>
                                                            </tr>
                                                            <% } %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="v-pills-settings" role="tabpanel"
                                                aria-labelledby="v-pills-settings-tab">
                                                <h1>관심 종목</h1>
                                                <div class="col-lg-12 col-md-12">
                                                    <div class="list-group">
                                                        <% for(info of result[3]) { %>
                                                        <span class="list-group-item">
                                                            <%= info.company_name %>
                                                        </span>
                                                        <% } %>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>          
                        </div>  
                    </div>
                </section>
            </div>
        </div>
    </div>
    <script src="/javascripts/main.js"></script>
</body>
</html>
<script>
    $(document).ready(function(){
        $('#nickname_change_btn').on('click',function(){
            console.log('nickname_change_btn click');

            var nickname = $('input[name=nickname_change]').val();
            $.ajax({
                url:'/users/change_nickname',
                type:'POST',
                data: {'nickname':nickname},
                success : function(result) {
                    console.log('닉네임 변경 완료');
                    alert('닉네임이 변경되었습니다.');
                    location.reload();
                }
            })
        }),
        $('#password_change_btn').on('click',function(){
            console.log('password_change_btn click');
            var currentPassword = $('input[name=current_password]').val();
            var changePassword = $('input[name=change_password]').val(); 
            var rechangePassword = $('input[name=change_repassword]').val();

            if(changePassword == rechangePassword) {
                $.ajax({
                    url:'/users/change_password',
                    type:'POST',
                    data: {
                        'currentPassword':currentPassword,
                        'changePassword' : changePassword
                    },
                    success : function(result) {
                        if(result == 100) {
                            alert('현재 비밀번호가 맞지 않습니다.');
                        } else if(result == 200) {
                            alert('비밀번호가 변경되었습니다.');
                        } else {
                            alert('ERROR');
                        }
                        location.reload();
                    }
                })
            } else {
                alert('변경할 비밀번호가 다릅니다.');
            }
        })
    })
</script>